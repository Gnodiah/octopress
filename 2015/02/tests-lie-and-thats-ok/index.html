
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tests lie and that's OK - 一根札记</title>
  <meta name="author" content="Hayden Wei">
  <meta name="Generator" content="Jekyll & Octopress (http://octopress.org)">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://haydenwei.com//posts/2015/02/tests-lie-and-thats-ok">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/octopress.min.js" type="text/javascript"></script>
  <link href="" rel="alternate" title="一根札记" type="application/atom+xml">
  



<!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  

  
  <link href="/images/custom/favicon.ico" rel="icon">
</head>

<body   >
  <div id="main">
    <div id="content">
      <div>











<article class="hentry " role="article">
  
  <header>
    <h1 class="entry-title">

<a href="/posts/2015/02/tests-lie-and-thats-ok">Tests lie and that's OK</a>

</h1>

    
      <p class="meta">
        








  



Written <time datetime="2015-02-28T12:15:00+08:00" pubdate data-updated="true">February 28, 2015 at 12:15 CST</time>.
        

<span class="categories">
  Tagged
  
    <a class='category' href='/posts/tag/testing/'>Testing</a>.
  
</span>


      </p>
    
  </header>


<div class="entry-content"><p>I wrote a test something like this:</p>

<figure class='code'><div class='highlight'><table><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Page</span><span class="p">,</span> <span class="s2">&quot;#normalize&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;strips spaces in every column&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">page</span> <span class="o">=</span> <span class="no">Page</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">page</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;  Title  &quot;</span>
</span><span class='line'>    <span class="n">page</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;  Desc  &quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">page</span><span class="o">.</span><span class="n">normalize</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;Title&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">expect</span><span class="p">(</span><span class="n">page</span><span class="o">.</span><span class="n">description</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;Desc&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>A code review comment said: Doesn&#8217;t this test lie? It makes claims about <em>every</em> column, but only tests two of them.</p>

<p>I&#8217;ve been thinking about this disparity for a while.</p>

<p>A lot of tests – perhaps most tests – lie in this sense. A test claims <code>it "uppercases input"</code> but only actually verifies a few transformations out of the infinite input space.</p>

<p>If you uppercase infinite input, you simply can&#8217;t cover every case. So you pick some interesting ones. Bugs are interesting cases you didn&#8217;t think of beforehand.</p>

<p>With <code>Page#normalize</code>, you <em>could</em> cover every column, but the value is low. If we write the test and code in tandem and in good faith, this approximation is fine and enough to give us confidence that it works as described.</p>

<p>If we cover every column by listing them all, we will probably forget to update the test when new columns are added, so the completeness is fleeting. That could be guarded against with more code, but the effort isn&#8217;t proportional to the derived value.</p>

<p>If we cover every column by introspection, we&#8217;ll probably write test code that mirrors the implementation, which depreciates the value of the test.</p>

<p>And even if we cover every column, we don&#8217;t cover every possible input. We need to draw the line somewhere.</p>

<p>I think of the test <em>description</em> as a statement of unbridled intent: we want the code to strip spaces in every column. The test <em>implementation</em> is then a kind of pragmatic judgment sampling that often will not correspond completely to the description. An optimistic lie. And that&#8217;s OK.</p>
</div>



  <footer>
    <p class="meta">
      

    </p>
    
      <div class="sharing">
  
  
  
  

</div>

    
    <p class="meta">
      
        <p>
          <strong>Newer:</strong>
          <a href="/posts/2015/03/cloud-computing-and-openshift">谈谈对云计算的一些理解</a>
        </p>
      
      
        <p>
          <strong>Older:</strong>
          <a href="/posts/2015/02/time-restricted-autodeploy">Time-restricted autodeploy</a>
        </p>
      
    </p>
  </footer>
</article>

<section>
  

  
</section>

</div>

<aside class="sidebar">
  
    <header class="site-header">
  <div class="the-pug">
    <a href="/">
      <img src="/images/custom/pug_1x.png" srcset="/images/custom/pug_2x.png 2x, /images/custom/pug_3x.png 3x" alt="">
    </a>
  </div>
  <h1 class="site-title"><a href="/">一根札记</a></h1>
  <p class="site-intro">
    A blog by <a href="http://haydenwei.com/">Hayden Wei</a>.
    <a href="">Subscribe by RSS.</a>
  </p>

  <p class="site-intro">
    Follow <a href="https://twitter.com/gnodiahwei">@gnodiahwei</a> on Twitter.
  </p>

  
</header>









  
</aside>


    </div>
  </div>
  <footer class="blog-footer" role="contentinfo"><p>
  Unless otherwise noted, code is <a href="http://en.wikipedia.org/wiki/MIT_License">MIT License</a> and graphics (excluding the blog art) is <a href="http://creativecommons.org/licenses/by/3.0/">CC BY License</a>.
</p>

<p>
  &copy; 2015 Hayden Wei.
  <a href="http://johannaost.com/813-the-pug-automatic">Pug art</a>
  by <a href="http://johannaost.com">Johanna Öst</a>.
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, with a custom theme.</span>
</p>

</footer>
  



  

  

  





</body>
</html>
